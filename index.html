<!DOCTYPE html>
<html lang="fr">
<head>
  <link rel="manifest" href="/manifest.json" />
  <meta name="theme-color" content="#2C3E50" />
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Stage Canada Planner</title>

  <!-- iOS PWA support -->
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
  <meta name="apple-mobile-web-app-title" content="Stage Planner CA" />
  <link rel="apple-touch-icon" href="/icons/icon-192.png" />

  <!-- CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet"/>
  <link href="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.4/index.global.min.css" rel="stylesheet"/>
  <link rel="stylesheet" href="css/style.css" />
</head>

<body class="d-flex">
  <!-- ðŸ‘‰ ton sidebar, onglets, dashboard, prÃ©paration, courses, etc. (inchangÃ©) -->

  <!-- JS Libraries -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.4/index.global.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>

  <!-- Firebase (Ã  retirer si non utilisÃ©) -->
  <script type="module" src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app.js"></script>
  <script type="module" src="https://www.gstatic.com/firebasejs/9.22.1/firebase-firestore.js"></script>
  <script type="module" src="js/firebase.js"></script>
  <script type="module" src="js/app.js"></script>

  <!-- Gun -->
  <script src="https://cdn.jsdelivr.net/npm/gun/gun.js"></script>

  <!-- Tes modules -->
  <script src="js/tasks.js"></script>
  <script src="js/courses.js"></script>
  <script src="js/dishes.js"></script>

  <!-- Initialisation -->
  <script>
  window.addEventListener("DOMContentLoaded", () => {
    try { window.initTasks && window.initTasks(); } catch(e){ console.error('initTasks KO', e); }
    try { window.initCourses && window.initCourses(); } catch(e){ console.error('initCourses KO', e); }
    try { window.initDishes && window.initDishes(); } catch(e){ console.error('initDishes KO', e); }
  });
  </script>

  <!-- Onglet calendrier -->
  <script>
  document.querySelector('button[data-bs-target="#preparation"]').addEventListener('shown.bs.tab', () => {
    window.dispatchEvent(new Event('resize'));
  });

  if ('serviceWorker' in navigator) {
    navigator.serviceWorker.register('/sw.js')
      .then(() => console.log('SW enregistrÃ©'))
      .catch(err => console.error('SW KO', err));
  }
  </script>

  <!-- Bandeau offline -->
  <script>
  function updateOnlineStatus() {
    const banner = document.getElementById('offline-banner');
    banner.style.display = navigator.onLine ? 'none' : 'block';
  }
  window.addEventListener('online', updateOnlineStatus);
  window.addEventListener('offline', updateOnlineStatus);
  window.addEventListener('DOMContentLoaded', updateOnlineStatus);
  </script>

  <!-- Navigation mobile -->
  <script>
  (function () {
    document.querySelectorAll('#mobile-nav [data-bs-target]').forEach(btn => btn.setAttribute('type','button'));
    document.querySelectorAll('#sidebar [data-bs-toggle="pill"]').forEach(btn => btn.setAttribute('type','button'));

    function showTab(targetSelector) {
      const sidebarTrigger = document.querySelector(`#sidebar [data-bs-target="${targetSelector}"]`);
      if (window.bootstrap && sidebarTrigger) {
        new bootstrap.Tab(sidebarTrigger).show();
      } else {
        document.querySelectorAll('.tab-pane').forEach(p => p.classList.remove('show','active'));
        const pane=document.querySelector(targetSelector);
        if (pane) pane.classList.add('show','active');
      }
    }

    document.querySelectorAll('#mobile-nav [data-bs-target]').forEach(btn => {
      btn.addEventListener('click', e => {
        e.preventDefault();
        showTab(btn.getAttribute('data-bs-target'));
      });
    });
  })();
  </script>

  <!-- Notifications -->
  <script>
  async function askNotifPermission() {
    if (!('Notification' in window) || !('serviceWorker' in navigator)) return;
    if (Notification.permission === 'default') {
      try { await Notification.requestPermission(); } catch {}
    }
  }
  window.addEventListener('DOMContentLoaded', askNotifPermission);
  </script>

  <!-- Bandeau Offline -->
  <div id="offline-banner" style="display:none; position:fixed; top:0; left:0; right:0; background:#ff4d4d; color:white; text-align:center; padding:8px; font-size:14px; z-index:2000;">
    Vous Ãªtes hors ligne â€” affichage en mode local
  </div>
</body>
</html>
